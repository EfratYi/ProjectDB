<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Athlete</title>
    <style>
        body { font-family: Arial, sans-serif; }
        form { max-width: 400px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-bottom: 10px; }
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%; padding: 8px; margin-top: 4px;
        }
        button { margin-top: 10px; }
        .player-fields { display: none; }
    </style>
    <script>
        function togglePlayerFields() {
            const isPlayer = document.getElementById('isplayer').checked;
            const playerFields = document.querySelectorAll('.player-fields');
            playerFields.forEach(field => {
                field.style.display = isPlayer ? 'block' : 'none';
            });
        }
     async function fetchTakenJerseyNumbers() {
        const teamSelect = document.getElementById('teamid');
        const teamId = teamSelect.value;
        const takenNumbersDiv = document.getElementById('taken-numbers');

        if (teamId) {
            try {
                const response = await fetch(`/athletes/taken_numbers/${teamId}`);
                const data = await response.json();
                if (data.length > 0) {
                    takenNumbersDiv.innerText = "Taken jersey numbers for this team: " + data.join(", ");
                } else {
                    takenNumbersDiv.innerText = "";
                }
            } catch (err) {
                takenNumbersDiv.innerText = "Error fetching jersey numbers";
            }
        } else {
            takenNumbersDiv.innerText = "";
        }
    }
     window.addEventListener('DOMContentLoaded', () => {
    togglePlayerFields(); // הצגת שדות בהתאם ל־checkbox
    document.getElementById('isplayer').addEventListener('change', togglePlayerFields);

    // הוספת מאזינים לשינויים בקבוצה ומספר החולצה
    document.getElementById('teamid').addEventListener('change', fetchTakenJerseyNumbers);
    document.getElementById('athletejerseynum').addEventListener('input', fetchTakenJerseyNumbers);
});

    </script>
</head>
<body>
    <h1 style="text-align:center;">Edit Athlete</h1>

    <form method="POST">
        <label>Name:
            <input type="text" name="athletename" value="{{ athlete.name }}" required>
        </label>
        <label>Gender:
            <input type="text" name="gender" value="{{ athlete.gender }}" required>
        </label>
        <label>Birthday:
            <input type="date" name="birthday" value="{{ athlete.birthday }}" required>
        </label>

        <label>Country:
            <select name="countryid" required>
                {% for id, name in countries %}
                    <option value="{{ id }}" {% if athlete.countryid == id %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </label>
        {% if athlete.height %}
        <label>Height:
         <input type="number" step="0.01" name="athleteheight" value="{{ athlete.height }}">
        </label>
        {% endif %}

        <label>Is Player:
            <input type="checkbox" id="isplayer" name="isplayer" {% if athlete.is_player %}checked{% endif %}>
        </label>

         <div class="player-fields">
            <label for="teamid">Team:</label>
            <select name="teamid" id="teamid">
                {% for team in teams %}
                    <option value="{{ team[0] }}">{{ team[1] }}</option>
                {% endfor %}
            </select>


            <label for="athletejerseynum">Jersey Number:</label>
<input type="number" name="athletejerseynum" id="athletejerseynum" value="{{ athlete.jersey_number or '' }}">
           <div id="taken-numbers" style="color: red; font-size: 0.9em;"></div>

            <label>Position:
                <select name="athleteposition">
                    {% for position in positions %}
                        <option value="{{ position }}" {% if athlete.position == position %}selected{% endif %}>
                            {{ position }}
                        </option>
                    {% endfor %}
                </select>
            </label>
        </div>

        <button type="submit">Save Changes</button>
        <a href="/athletes">Back</a>
    </form>
</body>
</html>