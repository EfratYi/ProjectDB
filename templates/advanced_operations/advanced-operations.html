<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced Operations</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-100 to-blue-200 text-gray-800 min-h-screen p-6">
    <div class="container mx-auto">
        <h1 class="text-4xl text-blue-900 font-bold text-center mb-10">Advanced Operations</h1>
        <a href="/" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-6 inline-block">Back to Main</a>

        <!-- Queries Section -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">Queries</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-2">Athletes Born After 2000 with Medals</h3>
                    <button onclick="runQuery1()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Run Query</button>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-2">Sports Statistics</h3>
                    <button onclick="runQuery2()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Run Query</button>
                </div>
            </div>
        </section>

        <!-- Functions Section -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">Functions</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-2">Top Athletes by Country</h3>
                    <input id="country-id" type="number" placeholder="Enter Country ID" class="border p-2 rounded w-full mb-2">
                    <button onclick="runFunction1()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Run Function</button>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-2">Average Team Score</h3>
                    <input id="team-id" type="number" placeholder="Enter Team ID" class="border p-2 rounded w-full mb-2">
                    <button onclick="runFunction2()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Run Function</button>
                </div>
            </div>
        </section>

        <!-- Procedures Section -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">Procedures</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-2">Assign Random Referees</h3>
                    <button onclick="runProcedure1()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Run Procedure</button>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-2">Update Medal Count by Country</h3>
                    <button onclick="runProcedure2()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Run Procedure</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6 relative">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl font-bold">&times;</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        function openModal(contentHtml) {
            const modal = document.getElementById('result-modal');
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = contentHtml;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('result-modal').classList.add('hidden');
        }

        async function runQuery1() {
            try {
                const response = await fetch('/advanced-operations/api/query1');
                const data = await response.json();
                let html = '<h2 class="text-2xl font-semibold mb-4">Athletes Born After 2000 with Medals</h2>';
                html += '<table class="w-full border-collapse border"><tr><th class="border p-2">Name</th><th class="border p-2">Gender</th><th class="border p-2">Country</th><th class="border p-2">Age</th><th class="border p-2">Best Medal</th></tr>';
                data.forEach(row => {
                    html += `<tr><td class="border p-2">${row.AthleteName}</td><td class="border p-2">${row.Gender}</td><td class="border p-2">${row.CountryName}</td><td class="border p-2">${row.Age}</td><td class="border p-2">${row.BestMedal}</td></tr>`;
                });
                html += '</table>';
                openModal(html);
            } catch (error) {
                openModal('<p class="text-red-500">Error fetching data: ' + error.message + '</p>');
            }
        }

        async function runQuery2() {
            try {
                const response = await fetch('/advanced-operations/api/query2');
                const data = await response.json();
                let html = '<h2 class="text-2xl font-semibold mb-4">Sports Statistics</h2>';
                html += '<table class="w-full border-collapse border"><tr><th class="border p-2">Sport</th><th class="border p-2">Competitions</th><th class="border p-2">Venues</th><th class="border p-2">Medals</th><th class="border p-2">Earliest Date</th></tr>';
                data.forEach(row => {
                    html += `<tr><td class="border p-2">${row.SportName}</td><td class="border p-2">${row.NumCompetitions}</td><td class="border p-2">${row.NumVenues}</td><td class="border p-2">${row.NumMedals}</td><td class="border p-2">${row.EarliestCompetitionDate}</td></tr>`;
                });
                html += '</table>';
                openModal(html);
            } catch (error) {
                openModal('<p class="text-red-500">Error fetching data: ' + error.message + '</p>');
            }
        }

        async function runFunction1() {
            const countryId = document.getElementById('country-id').value;
            if (!countryId) {
                openModal('<p class="text-red-500">Please enter a Country ID</p>');
                return;
            }
            try {
                const response = await fetch(`/advanced-operations/api/function1?countryId=${countryId}`);
                const data = await response.json();

                if (!Array.isArray(data)) {
                    openModal('<p class="text-red-500">Unexpected data format received.</p>');
                    return;
                }

                if (data.length === 0) {
                    openModal('<p>No athletes found for this country.</p>');
                    return;
                }

                let html = '<h2 class="text-2xl font-semibold mb-4">Top Athletes by Country</h2>';
                html += '<table class="w-full border-collapse border"><tr><th class="border p-2">Athlete Name</th><th class="border p-2">Total Medals</th></tr>';
                data.forEach(row => {
                    html += `<tr><td class="border p-2">${row.athletename}</td><td class="border p-2">${row.total_medals}</td></tr>`;
                });
                html += '</table>';
                openModal(html);
            } catch (error) {
                openModal('<p class="text-red-500">Error fetching data: ' + error.message + '</p>');
            }
        }

        async function runFunction2() {
            const teamId = document.getElementById('team-id').value;
            if (!teamId) {
                openModal('<p class="text-red-500">Please enter a Team ID</p>');
                return;
            }
            try {
                const response = await fetch(`/advanced-operations/api/function2?teamId=${teamId}`);
                const data = await response.json();
                openModal(`<p class="text-green-600 text-xl">Average Team Score: ${data.avg_score}</p>`);
            } catch (error) {
                openModal('<p class="text-red-500">Error fetching data: ' + error.message + '</p>');
            }
        }

        async function runProcedure1() {
            try {
                const response = await fetch('/advanced-operations/api/procedure1', { method: 'POST' });
                const data = await response.json();
                if (data.message) {
                    openModal(`<p class="text-green-600 text-xl">${data.message}</p>`);
                } else {
                    openModal(`<p class="text-red-500">${data.error}</p>`);
                }
            } catch (error) {
                openModal('<p class="text-red-500">Error executing procedure: ' + error.message + '</p>');
            }
        }

        async function runProcedure2() {
            try {
                const response = await fetch('/advanced-operations/api/procedure2', { method: 'POST' });
                const data = await response.json();
                if (data.message) {
                    openModal(`<p class="text-green-600 text-xl">${data.message}</p>`);
                } else {
                    openModal(`<p class="text-red-500">${data.error}</p>`);
                }
            } catch (error) {
                openModal('<p class="text-red-500">Error executing procedure: ' + error.message + '</p>');
            }
        }
    </script>
</body>
</html>
