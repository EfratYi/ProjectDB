<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Athlete</title>
    <style>
        body { font-family: Arial, sans-serif; }
        form { max-width: 400px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-bottom: 5px; margin-top: 10px; }
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%; padding: 8px; margin-top: 4px;
        }
        button { margin-top: 15px; }
        .player-fields { display: none; }
    </style>
    <script>
        function togglePlayerFields() {
            const isPlayer = document.getElementById('isplayer').checked;
            const playerFields = document.querySelectorAll('.player-fields');
            playerFields.forEach(field => {
                field.style.display = isPlayer ? 'block' : 'none';
            });
        }
  async function fetchTakenJerseyNumbers() {
        const teamSelect = document.getElementById('teamid');
        const teamId = teamSelect.value;
        const takenNumbersDiv = document.getElementById('taken-numbers');

        if (teamId) {
            try {
                const response = await fetch(`/athletes/taken_numbers/${teamId}`);
                const data = await response.json();
                if (data.length > 0) {
                    takenNumbersDiv.innerText = "Taken jersey numbers for this team: " + data.join(", ");
                } else {
                    takenNumbersDiv.innerText = "";
                }
            } catch (err) {
                takenNumbersDiv.innerText = "Error fetching jersey numbers";
            }
        } else {
            takenNumbersDiv.innerText = "";
        }
    }
      window.addEventListener('DOMContentLoaded', () => {
    togglePlayerFields(); // הצגת שדות בהתאם ל־checkbox
    document.getElementById('isplayer').addEventListener('change', togglePlayerFields);

    // הוספת מאזינים לשינויים בקבוצה ומספר החולצה
    document.getElementById('teamid').addEventListener('change', fetchTakenJerseyNumbers);
    document.getElementById('athletejerseynum').addEventListener('input', fetchTakenJerseyNumbers);
});

    </script>
</head>
<body>
    <h1 style="text-align:center;">Add New Athlete</h1>

    <form method="POST">
        <label for="athletename">Name:</label>
        <input type="text" name="athletename" id="athletename" required>

        <label for="gender">Gender:</label>
        <select name="gender" id="gender" required>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>

        <label for="birthday">Birthday:</label>
        <input type="date" name="birthday" id="birthday" required>

        <label for="countryid">Country:</label>
        <select name="countryid" id="countryid" required>
            {% for country in countries %}
                <option value="{{ country[0] }}">{{ country[1] }}</option>
            {% endfor %}
        </select>

          <label for="athleteheight">Height (cm):</label>
        <input type="number" name="athleteheight" id="athleteheight">

        <label for="isplayer">Is Player:</label>
        <input type="checkbox" name="isplayer" id="isplayer">

        <div class="player-fields">
            <label for="teamid">Team:</label>
            <select name="teamid" id="teamid">
                {% for team in teams %}
                    <option value="{{ team[0] }}">{{ team[1] }}</option>
                {% endfor %}
            </select>

           <label for="athletejerseynum">Jersey Number:</label>
           <input type="number" name="athletejerseynum" id="athletejerseynum"><br>
           <div id="taken-numbers" style="color: red; font-size: 0.9em;"></div>


            <label for="athleteposition">Position:</label>
            <select name="athleteposition" id="athleteposition">
                <option value="" selected disabled>Select Position</option>
                {% for pos in positions %}
                    <option value="{{ pos }}">{{ pos }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit">Add Athlete</button>
    </form>
</body>
</html>
